<?php
$screens = $block->getJson($block->getScreenProducts());
$projectors = $block->getJson($block->getProjectorProducts());
?>

<div class="wrapper">
    <div class="projector-distance-widget" x-data='{
        projectors: <?php echo $projectors; ?>,
        screens: <?php echo $screens; ?>,
        selectedProjectorSKU: "",
        selectedScreenSKU: "",
        selectedUnit: "mm",
        selectedProjector: null,
        selectedScreen: null,
        inputScreenSize: null,
        projectedDistance: {
            min: null,
            max: null
        },
        selectProduct() {
            this.selectedProjector = this.projectors.find(product => product.sku === this.selectedProjectorSKU);
            this.selectedScreen = this.screens.find(screen => screen.sku === this.selectedScreenSKU);
        },
        handleScreenSizeInput() {
            if (this.selectedProjector && this.inputScreenSize) {
                this.projectedDistance.min = Math.round(this.inputScreenSize * this.selectedProjector.projector_throw_min);
                this.projectedDistance.max = Math.round(this.inputScreenSize * this.selectedProjector.projector_throw_max);
            }
        }
    }'
         x-init="selectProduct"
    >
        <select x-model="selectedProjectorSKU" @change="selectProduct">
            <option value="" disabled selected>Select a projector</option>
            <template x-for="(product, index) in projectors" :key="index">
                <option :value="product.sku" x-text="product.sku"></option>
            </template>
        </select>

        <!--
        <select x-model="selectedScreenSKU" @change="selectProduct">
            <option value="" disabled selected>Select a screen</option>
            <template x-for="(screen, index) in screens" :key="index">
                <option :value="screen.sku" x-text="`${screen.sku} (Width: ${screen.width}, Height: ${screen.height})`"></option>
            </template>
        </select>
        -->

        <select x-model="selectedUnit">
            <option value="mm">Millimeters</option>
            <option value="cm">Centimeters</option>
            <option value="inches">Inches</option>
            <option value="meters">Meters</option>
        </select>

        <form @submit.prevent="handleScreenSizeInput">
            <label for="screenSize">Screen Size:</label>
            <input id="screenSize" type="number" step="0.01" x-model="inputScreenSize">
            <button type="submit">Submit</button>
        </form>

        <div x-show="selectedProjector">
            <!--
            <p>Name: <span x-text="selectedProjector.name"></span></p>
            <p>SKU: <span x-text="selectedProjector.sku"></span></p>
            <p>Min Throw: <span x-text="selectedProjector.projector_throw_min"></span></p>
            <p>Max Throw: <span x-text="selectedProjector.projector_throw_max"></span></p>
            -->
            <p x-show="projectedDistance.min && projectedDistance.max">For the given screen size, the projector can be placed between <span x-text="projectedDistance.min"></span> <span x-text="selectedUnit"></span> and <span x-text="projectedDistance.max"></span> <span x-text="selectedUnit"></span> away.</p>
        </div>

        <div x-show="selectedScreen">
            <h2>Selected Screen:</h2>
            <p>Name: <span x-text="selectedScreen.name"></span></p>
            <p>SKU: <span x-text="selectedScreen.sku"></span></p>
            <p>Width: <span x-text="selectedScreen.width"></span></p>
            <p>Height: <span x-text="selectedScreen.height"></span></p>
        </div>
    </div>
</div>
